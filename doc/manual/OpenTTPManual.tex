%%  export TEXINPUTS=.:/home/mjw/src/manuals/common:

\documentclass[11pt,a4paper,openany,oneside]{book}

\usepackage[usenames]{color}
\usepackage{epsfig}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{parskip}
\usepackage{pifont}
\usepackage{rotating}
\usepackage{enumitem}
\usepackage{latexsym}
\usepackage{titlesec}
\usepackage{xcolor}
\usepackage{fancybox}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{hyperref} % wants to be last

\hypersetup{
  colorlinks   = true, %Colours links instead of ugly boxes
  urlcolor     = blue, %Colour for external hyperlinks
  linkcolor    = blue, %Colour of internal links
  citecolor   = red %Colour of citations
}

\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter.\ #1}{}} 
\fancyhead[LE,LO]{\slshape \leftmark}
\fancyhead[RE,RO]{}

% Define some colours
\definecolor{OTTPGreen}{rgb}{0,0.341,0}

% Set formats for each heading level

\titleformat{\chapter}
{}
{\Huge\bfseries\sffamily\color{OTTPGreen}  \thechapter .\space}
{0pt}
{\Huge\bfseries\sffamily\color{OTTPGreen}}

% Change the format of sections
\titleformat*{\section}{\Large\bfseries\sffamily\color{OTTPGreen}}
\titleformat*{\subsection}{\large\bfseries\sffamily\color{OTTPGreen}}
\titleformat*{\subsubsection}{\normalsize\bfseries\sffamily\color{OTTPGreen}}

\newcommand{\ci}[1]{\hspace*{1cm} {\small\texttt{#1}}}
\newcommand{\cc}[1]{{\texttt{#1}}}
\newcommand{\mykey}[1]{{\makebox[16pt] {\put(0,4){\circle{12}} \put(0,4){\makebox(0,0){\small{#1}}}}}}

\newcommand{\sysname}{{TTP}}
\newcommand{\longsysname}{{Time Transfer Platform}}

% Set bullet style
\renewcommand{\labelitemi}{$\Box$} 
\renewcommand{\labelitemii}{$\Box$} 
\renewcommand{\labelitemiii}{$\Box$} 
\renewcommand{\labelitemiv}{$\Box$} 

\newenvironment{description*}%
  {\setlength{\parskip}{0pt}%
	 \begin{description}%
		\setlength{\topsep}{-12pt}%
		\setlength{\itemindent}{-12pt}%
    \setlength{\itemsep}{0pt}%
		\setlength{\itemsep}{0pt}}%
  {\end{description}}

\newenvironment{enumerate*}%
  {\begin{enumerate}%
		\setlength{\topsep}{-12pt}%
		\setlength{\itemindent}{-12pt}%
    \setlength{\itemsep}{0pt}%
		\setlength{\parindent}{0pt}}%
  {\end{enumerate}}
  
\begin{document}

\begin{titlepage}

\begin{center}
\centerline{\includegraphics{figures/ottplogo.png}}
\end{center}

\vspace*{4cm} 

\begin{center}
{\Huge The Open Traceable Time Platform}
\end{center}

\vspace*{4cm} 

\begin{center}
{\Huge User Manual}
\end{center}

\vspace*{4cm}

\begin{center}
Version 1.0
\end{center}

\begin{center}
Copyright 2016 E. Louis Marais, Michael Wouters
\end{center}

\end{titlepage}


\begin{titlepage}

\begin{center}
{\Large This work is licensed under a Creative \\
Commons Attribution 4.0 International License.}
\end{center}

\end{titlepage}

\tableofcontents
\listoffigures
\listoftables

\lstset{
	xleftmargin=24pt,
	basewidth=0.5em,
	basicstyle=\ttfamily,
	escapechar=\%
}

%% ****************************************************************************************
\chapter{Introduction}
%% ****************************************************************************************

\input{srcs/Introduction}

%% ****************************************************************************************
\chapter{Getting started with the Reference Platform}
%% ****************************************************************************************

\input{srcs/GettingStarted}

%% ****************************************************************************************
\chapter{Installing the software}
%% ****************************************************************************************

This chapter describes how to install the software in an environment other than the OpenTTP Refernec Platform.

\section{Software installation requirements}

In addition to a basic Linux development environment (C/C++/Perl/Python), you will need the development packages for:
\begin{description*}
	\item[\cc{boost}]  C++ libraries
	\item[\cc{libgsl}] GNU scientific library
	\item[\cc{libusb}] libusb library (for communicating with the Opal Kelly XEM6001)
\end{description*}

Depending on your Linux installation, you may also need
\begin{description*}
	\item[\cc{Time::HiRes}] Perl library
\end{description*}

The names of the required packages will depend on the Linux distribution that you are using.

\section{Building and installing the software}

Two scripts are provided for installing the software.
\begin{lstlisting}
software/system/installsys.pl
software/gpscv/install.pl
\end{lstlisting}

\cc{installsys.pl} must be run first (with superuser privileges), 
because it installs libraries which are needed by the GPSCV software.

Run-time options can be viewed by running the script with the '-h' option. In particular, \cc{installsys.pl}
has options to list the available installation targets and to install particular targets.

\section{A minimal software setup}

Some users may only be interested in the core software that OpenTTP provides so that they can use
it with their own hardware. This section describes the minimum setup required for operation.

The OpenTTP software distribution is comprised of various C/C++ applications and Perl scripts.
As a minimum, you will need:
\begin{description*}
	\item \cc{TFLibrary.pm} Perl module for commonly used tasks, such as reading configuration files
	\item \cc{libconfigurator} C library for parsing configuration files
	\item \cc{lockport} utility to create a UUCP lock file
	\item \cc{mktimetx} creates time-transfer files
	\item one of the OpenTTP-provided scripts to log your receiver
	\item one of the OpenTTP-provided scripts to log your counter/timer
\end{description*}

You must use one of the OpenTTP receiver logging scripts for the GNSS receiver because \cc{mktimetx}
expects a custom file-format \ref{s:DataFileFormat}. In particular, the
receiver's native binary formats are not readable by \cc{mktimetx}. Similarly, OpenTTP uses a custom file
format for the counter-timer measurement files, although in this case, conversion from another format
will probably be straight-forward. Most likely, users will have to provide their own software for
logging their counter/timer, given the large number of possible devices here, and the limited
support within OpenTTP.

You may find the following scripts useful for automating operation:
\begin{description*}
	\item[] \cc{kickstart.pl} for automatic start of logging processes
	\item[] \cc{runmktimetx.pl} for automated processing, and reprocessing
	\item[] \cc{ziplogs.pl} for log file compression
\end{description*}	

Sample configuration files can be found in \cc{software/gpscv/common/etc}.
The user running the logging and processing needs the following directories (or equivalents - most paths
can be configured via the general configuration file, \ref{sgpscvconf}):
\cc{bin}, \cc{cggtts},\cc{etc},\cc{logs},\cc{raw},\cc{rinex},\cc{tmp}. Some of these paths can
be redefined in the configuration file \cc{gpscv.conf}.


%% ****************************************************************************************
\chapter{The reference platform hardware}
%% ****************************************************************************************

This chapter provides a more detailed description of the reference platform hardware.

\input{srcs/antenna}
\input{srcs/counter}


%% ****************************************************************************************
\chapter{GPSCV software}
%% ****************************************************************************************

\input{srcs/GPSCV.tex}

%% ****************************************************************************************
\chapter{System software}
%% ****************************************************************************************

\input{srcs/kickstart}

\input{srcs/mjd}

\input{srcs/okcounterd}

\input{srcs/okcounterdctl}

\input{srcs/lcdmonitor}

\section{libraries}

\subsection{libconfigurator}

\subsection{TFLibrary.pm}

\input{srcs/sysmonitor}

\input{srcs/gziplogs}

\end{document}

