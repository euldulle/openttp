%%  export TEXINPUTS=.:/home/mjw/src/manuals/common:

\documentclass[11pt,a4paper,openany,oneside]{book}

\usepackage{hyperref} 
\usepackage{listings}
\usepackage{graphicx}
\usepackage{parskip}
\usepackage{enumitem}
\usepackage{latexsym}

\newcommand{\ci}[1]{\hspace*{1cm} {\small\texttt{#1}}}
\newcommand{\cc}[1]{{\texttt{#1}}}
% Set bullet style
\renewcommand{\labelitemi}{$\Box$} 

\newenvironment{description*}%
  {\setlength{\parskip}{0pt}%
	 \begin{description}%
		\setlength{\topsep}{-12pt}%
		\setlength{\itemindent}{-12pt}%
    \setlength{\itemsep}{0pt}%
		\setlength{\itemsep}{0pt}}%
  {\end{description}}

\newenvironment{enumerate*}%
  {\begin{enumerate}%
		\setlength{\topsep}{-12pt}%
		\setlength{\itemindent}{-12pt}%
    \setlength{\itemsep}{0pt}%
		\setlength{\parindent}{0pt}}%
  {\end{enumerate}}
  
\begin{document}

\begin{titlepage}

\begin{center}
{\Huge OpenTTP manual}
\end{center}

\vspace*{4cm}
\begin{center}
Version 1.0
\end{center}

\begin{center}
Copyright 2016 OpenTTP
\end{center}

\end{titlepage}

\tableofcontents
\listoffigures
\listoftables

\lstset{
	xleftmargin=24pt,
	basewidth=0.5em,
	basicstyle=\ttfamily,
	escapechar=\%
}

%% ****************************************************************************************
\chapter{Introduction}
%% ****************************************************************************************

\section{What is OpenTTP?}

\section{GPS common-view}

\section{The OpenTTP reference platform}

\section{Supported hardware}

	\subsection{GNSS receivers}
	
	\begin{table}
	\begin{tabular}{lll}
	Manufacturer & models & notes \\ \hline
	Javad & GRIL receivers & obsolete \\
	NVS   & NV08 & \\
	Trimble & Resolution T & obsolete\\
	ublox & Neo8MT & \\
	\end{tabular}
	\caption{Supported GPS/GNSS receivers.}
	\end{table}
	
	Note: OpenTTP uses a custom file format for logging GPS receiver data. It does not read native receiver binary-format files.
	
	Guidance on testing a receiver for suitability for time-transfer, and writing software to process
	the receiver's data, is given in the OpenTTP Developer's Guide.
	
	\subsection{Counter/timers}
	
	\begin{table}
	\begin{tabular}{lll}
	Manufacturer & models & notes \\ \hline
	Agilent & 5313x &  needs IOTech GPIB to RS232 converter\\
	OpenTTP &  & \\
	SRS & PRS10 & uses input 1 pps time-tagging function\\
	\end{tabular}
	\caption{Supported counter/timers.}
	\end{table}
	
%% ****************************************************************************************
\chapter{Getting started}
%% ****************************************************************************************

\section{Software installation requirements}

In addition to a basic Linux development environment, you will need the development packages for:
\begin{description*}
	\item[\cc{boost}]   
	\item[\cc{libgsl}] GNU scientific library
\end{description*}

Depending on your Linux installation, you may also need
\begin{description*}
	\item[\cc{Time::HiRes}] Perl library
\end{description*}

\section{Building and installing the software}

Two scripts are provided for installing the software.
\begin{lstlisting}
software/system/installsys.pl
software/gpscv/install.pl
\end{lstlisting}

\cc{installsys.pl} must be run first, because it installs libraries which are needed by the GPSCV software.

Run-time options can be viewed by running the script with the '-h' option. In particular, \cc{installsys.pl}
has options to list the available installation targets and to install particular targets.

\section{A minimal software setup}

Some users may only be interested in the core software that OpenTTP provides so that they can use
it with their own hardware. This section describes the minimum setup required for operation.

The OpenTTP software distribution is comprised of various C/C++ applications and Perl scripts.
As a minimum, you will need:
\begin{description*}
	\item \cc{TFLibrary.pm} Perl module for commonly used tasks, such as reading configuration files
	\item \cc{libconfigurator} C library for parsing configuration files
	\item \cc{lockport} utility to create a UUCP lock file
	\item \cc{mktimetx} creates time-transfer files
	\item one of the OpenTTP-provided scripts to log your receiver
	\item one of the OpenTTP-provided scripts to log your counter/timer
\end{description*}

You must use one of the OpenTTP receiver logging scripts because \cc{mktimetx} expects a custom file-format. In particular, the
receiver's native binary formats are not readable by \cc{mktimetx}. Similarly, OpenTTP uses a custom file
format for the counter-timer measurement files, although in this case, conversion from another format
will probably be straight-forward. Most likely, users will have to provide their own software for
logging their counter/timer, given the large number of possible devices here, and the limited
support within OpenTTP.

You may find the following useful:
\begin{description*}
	\item[] \cc{kickstart.pl} for automatic start of logging processes
	\item[] \cc{runmktimetx.pl} for automated processing, and reprocessing
	\item[] \cc{ziplogs.pl} for log file compression
\end{description*}	

Sample configuration files can be found in \cc{software/gpscv/common/etc}.
The user running the logging and processing needs the following directories (or equivalents - most paths
can be configured via the general configuration file, \ref{sgpscvconf}):
\cc{bin}, \cc{cggtts},\cc{etc},\cc{logs},\cc{raw},\cc{rinex},\cc{tmp}.

%% ****************************************************************************************
\chapter{System hardware}
%% ****************************************************************************************

\input{srcs/counter}


%% ****************************************************************************************
\chapter{GPSCV software}
%% ****************************************************************************************

\section{Configuration file format \label{sConfigFileFormat}}

Configuration files use a common format and are plain text files, designed to be easily edited via a command-line
editor because in many applications, only shell access to the system will be available.

The file is divided into sections, with section names delimited by square brackets [ ]. Entries in each section
are of the form:
\begin{lstlisting}
key = value
\end{lstlisting}
For example,
\begin{lstlisting}
[Receiver]
manufacturer = Trimble
model = Resolution T
\end{lstlisting}
defines a section `Receiver' and the receiver's manufacturer and model. 
The notation \cc{Section::Key} is used to describe keys. For example,
\cc{Receiver::model} and \cc{Receiver::manufacturer} describe the two keys above.

Keys and section names are not case-sensitive. Comments begin with a '\#'.

Some keys define a list of sections. For example, the comma-separated list of values for 'outputs' 
\begin{lstlisting}
[CGGTTS]
outputs = C1-code,P1-code,P2-code
\end{lstlisting}
defines three sections: \cc{C1-code}, \cc{P1-code}, and \cc{P2-code}.

\input{srcs/gpscvconf}

\input{srcs/mktimetx}

\input{srcs/runmktimetx}

\section{Counter/timer logging scripts}

\subsection{hp5313xlog.pl}

There is a file \cc{hp5313x.cmds} which lists the SCPI commands used to configure the counter.
For example:
\begin{lstlisting}
:FUNC 'TINT 1,2'                # time interval
:SENS:EVEN1:LEVEL:ABS 1.0       # trigger level 1 volt
:SENS:EVEN2:LEVEL:ABS 1.0       #
:SENS:EVEN1:SLOP POS            # trigger on positive slope
:SENS:EVEN2:SLOP POS
:INP1:ATT 1                     # input attenuation x1
:INP2:ATT 1
:INP1:COUP DC                   # coupling DC
:INP2:COUP DC
:INP1:IMP 50                    # impedance 50 ohms
:INP2:IMP 50
\end{lstlisting}

\subsection{okxemlog.pl}

The OpenTTP reference platform includes a multi-channel TIC

It has the following specific configuration file entries:
It also uses:

\section{Receiver logging scripts}

\subsection{jnslog.pl}

There is a file \cc{receiver.conf} which lists the commands used to configure the receiver.

\subsection{nvslog.pl}

The NVS receiver is entirely configured using the script.

\subsection{restlog.pl}

The Resolution T receiver is entirely configured using the script.

\subsection{ubloxlog.pl}

The ublox receiver is entirely configured using the script.

\section{Receiver utilities}

\subsection{Trimble Resolution T}

\subsection{NVS NV08}

\subsection{ublox}

\subsection{Javad}


%% ****************************************************************************************
\chapter{System software}
%% ****************************************************************************************

\section{kickstart.pl}

\input{srcs/mjd}

\input{srcs/okcounterd}

\section{okcounterdctl.pl}

\section{ziplogs.pl}

\input{srcs/lcdmonitor}

\section{libraries}

\subsection{libconfigurator}

\input{srcs/sysmonitor}

\subsection{TFLibrary.pm}

\end{document}

